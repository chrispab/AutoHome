rule "StartUp - set up Item Scene_Goodnight"
when
    System started
then
    Scene_Goodnight.postUpdate(OFF)
end

rule "Goodnight Going to bed"
when
//	Item Scene_Goodnight received command ON
	Item Scene_Goodnight changed from OFF to ON
then
    logInfo("RULE", "goodnight going to bed")

    //turn off sockets
    {sendCommand(socketG2_1, OFF)} //con lights
    {postUpdate(socketG2_1, OFF)}
    // {sendCommand(socketG2_4, OFF)} //tv
    // {postUpdate(socketG2_4, OFF)}
    // {sendCommand(socketG2_3, OFF)} // amp
    // {postUpdate(socketG2_3, OFF)}    
    {sendCommand(socketG2_2, OFF)} //radio
    {postUpdate(socketG2_2, OFF)}
    {postUpdate(conservatoryTVPower, OFF)}

    
    // {sendCommand(gIkeaLights, OFF)} //
    // {postUpdate(gIkeaLights, OFF)} 
        gIkeaLights.sendCommand(new PercentType(0))
        gIkeaLights.postUpdate(new PercentType(0))
    //set rads temps to off
    conservatory_Heating_PresetTempNormal.postUpdate(17.0)
    frontRoom_Heating_PresetTempNormal.postUpdate(14.0)
    elsiesRoom_Heating_PresetTempNormal.postUpdate(17.0)
    attic_Heating_PresetTempNormal.postUpdate(14.0)
    bedroom_Heating_PresetTempNormal.postUpdate(17.0)
    office_Heating_PresetTempNormal.postUpdate(17.0)
    hall_Heating_PresetTempNormal.postUpdate(17.0)
    Heating_UpdateHeaters.sendCommand(ON)    

    // var Timer lightsTimer = null
    createTimer(now.plusSeconds(240), [|
        {sendCommand(socketG1_4, OFF)} // d room lights
        {postUpdate(socketG1_4, OFF)}
        logInfo("RULE", "Item Scene_Goodnight now set to OFF again")

    ])
    logInfo("RULE", "Item Scene_Goodnight received command ON")

    Scene_Goodnight.postUpdate(OFF)
end