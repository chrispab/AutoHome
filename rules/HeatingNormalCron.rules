
var Number sleepTemp = 16
var Number offTemp = 14
var Number liveTemp = 21.5
var Number midTemp = 18
var Number lowTemp = 16
var Number morningTemp = 20
var Number eveningTemp = 23
var Number highTemp = 23


// master heating mode - NORMAL mode rules
rule "00:00"
when
    Time cron "0 00 00 ? * MON-FRI *"
then
    CT_Heating_PresetTempNormal.postUpdate(sleepTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Office_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Hall_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "00:30"
when
    Time cron "0 30 00 ? * MON-FRI *"
then
    CT_Heating_PresetTempNormal.postUpdate(sleepTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp )
    E_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp )
    J_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Office_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Hall_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "01:00 - all heating low"
when
    Time cron "0 00 01 ? * * *"
then
    CT_Heating_PresetTempNormal.postUpdate(sleepTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp )
    E_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp )
    J_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Office_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Hall_Heating_PresetTempNormal.postUpdate(offTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "02:30 - all heating low"
when
    Time cron "0 30 02 ? * * *"
then
    CT_Heating_PresetTempNormal.postUpdate(sleepTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp )
    E_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp )
    J_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Office_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Hall_Heating_PresetTempNormal.postUpdate(offTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "start heating early if cold outside - 04:30 am"
when
    Time cron "0 30 04 ? * MON-FRI *"
then
    var Number temp = Outside_Temperature.state as DecimalType // get the current temperature
    if (temp < 1.0 ) {  // determine whether we need to turn on/off the heater
        CT_Heating_PresetTempNormal.postUpdate(highTemp)
        FR_Heating_PresetTempNormal.postUpdate(offTemp)
        E_BR_Heating_PresetTempNormal.postUpdate(offTemp)
        Attic_Heating_PresetTempNormal.postUpdate(offTemp)
        J_BR_Heating_PresetTempNormal.postUpdate(offTemp)
        Office_Heating_PresetTempNormal.postUpdate(offTemp)
        Hall_Heating_PresetTempNormal.postUpdate(offTemp)
        Heating_UpdateHeaters.sendCommand(ON)
    }
end

rule "start heating early if cold outside - 05:30 am"
when
    Time cron "0 30 05 ? * MON-FRI *"
then
    var Number temp = Outside_Temperature.state as DecimalType // get the current temperature
    if (temp < 5.0 ) {  // determine whether we need to turn on/off the heater
        CT_Heating_PresetTempNormal.postUpdate(highTemp)
        FR_Heating_PresetTempNormal.postUpdate(offTemp)
        E_BR_Heating_PresetTempNormal.postUpdate(offTemp)
        Attic_Heating_PresetTempNormal.postUpdate(offTemp)
        J_BR_Heating_PresetTempNormal.postUpdate(offTemp)
        Office_Heating_PresetTempNormal.postUpdate(offTemp)
        Hall_Heating_PresetTempNormal.postUpdate(offTemp)
        Heating_UpdateHeaters.sendCommand(ON)
    }
end

rule "NORMAL heating - 06:30 am"
when
    Time cron "0 30 06 ? * MON-FRI *"
then
    CT_Heating_PresetTempNormal.postUpdate(highTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(morningTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(morningTemp)
    Office_Heating_PresetTempNormal.postUpdate(offTemp)
    Hall_Heating_PresetTempNormal.postUpdate(offTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "heating 08:15 am"
when
    Time cron "0 15 08 ? * MON-FRI *"
then
    CT_Heating_PresetTempNormal.postUpdate(offTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(offTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(offTemp)
    Office_Heating_PresetTempNormal.postUpdate(offTemp)
    Hall_Heating_PresetTempNormal.postUpdate(offTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "14:30"
when
    Time cron "0 30 14 ? * MON-FRI *"
then
    // CT_Heating_PresetTempNormal.postUpdate(21.0)
    //FR_Heating_PresetTempNormal.postUpdate(20.0)
    // E_BR_Heating_PresetTempNormal.postUpdate(17.0)
    // Attic_Heating_PresetTempNormal.postUpdate(17.0)
    // J_BR_Heating_PresetTempNormal.postUpdate(17.0)
    //Office_Heating_PresetTempNormal.postUpdate(17.0)
    //Hall_Heating_PresetTempNormal.postUpdate(17.0)
    Heating_UpdateHeaters.sendCommand(ON)
end


rule "afternoon - start heating early if cold outside - 03:00 pm"
when
    Time cron "0 00 15 ? * MON-FRI *"
then
    var Number temp = Outside_Temperature.state as DecimalType // get the current temperature
    if (temp < 5.0) {  // determine whether we need to turn on/off the heater
        CT_Heating_PresetTempNormal.postUpdate(eveningTemp)
        FR_Heating_PresetTempNormal.postUpdate(offTemp)
        E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
        Attic_Heating_PresetTempNormal.postUpdate(offTemp)
        J_BR_Heating_PresetTempNormal.postUpdate(offTemp)
        Office_Heating_PresetTempNormal.postUpdate(offTemp)
        Hall_Heating_PresetTempNormal.postUpdate(offTemp)
        Heating_UpdateHeaters.sendCommand(ON)
    }
end

rule "16:00"
when
    Time cron "0 00 16 ? * MON-FRI *"
then
    CT_Heating_PresetTempNormal.postUpdate(eveningTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Office_Heating_PresetTempNormal.postUpdate(midTemp)
    Hall_Heating_PresetTempNormal.postUpdate(midTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "22:30 weekdays"
when
    Time cron "0 30 22 ? * MON-FRI *"
then
    CT_Heating_PresetTempNormal.postUpdate(eveningTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Office_Heating_PresetTempNormal.postUpdate(midTemp)
    Hall_Heating_PresetTempNormal.postUpdate(offTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "11:30pm weekdays"
when
    Time cron "0 30 23 ? * MON-FRI *"
then
    CT_Heating_PresetTempNormal.postUpdate(midTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Office_Heating_PresetTempNormal.postUpdate(midTemp)
    Hall_Heating_PresetTempNormal.postUpdate(offTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end


rule "TEST  weekdays"
when
    Time cron "0 58 08 ? * MON-FRI *"
then
    logInfo("TEST CRON RULE", "test ran live temp" + liveTemp)

    // CT_Heating_PresetTempNormal.postUpdate(liveTemp)
    // FR_Heating_PresetTempNormal.postUpdate(liveTemp)
    // E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    // Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    // J_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    // Office_Heating_PresetTempNormal.postUpdate(midTemp)
    // Hall_Heating_PresetTempNormal.postUpdate(midTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end


rule "00:30 am weekend"
when
    Time cron "0 30 00 ? * SAT-SUN *"
then
    CT_Heating_PresetTempNormal.postUpdate(sleepTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp )
    E_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp )
    J_BR_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Office_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Hall_Heating_PresetTempNormal.postUpdate(sleepTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end


rule "8:00 am weekend"
when
    Time cron "0 0 8 ? * SAT-SUN *"
then
    CT_Heating_PresetTempNormal.postUpdate(liveTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Office_Heating_PresetTempNormal.postUpdate(offTemp)
    Hall_Heating_PresetTempNormal.postUpdate(offTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "4:30pm weekend"
when
    Time cron "0 30 16 ? * SAT-SUN *"
then
    CT_Heating_PresetTempNormal.postUpdate(liveTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Office_Heating_PresetTempNormal.postUpdate(offTemp)
    Hall_Heating_PresetTempNormal.postUpdate(offTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end

rule "22:30pm weekend"
when
    Time cron "0 30 22 ? * SAT-SUN *"
then
    CT_Heating_PresetTempNormal.postUpdate(liveTemp)
    FR_Heating_PresetTempNormal.postUpdate(offTemp)
    E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Attic_Heating_PresetTempNormal.postUpdate(offTemp)
    J_BR_Heating_PresetTempNormal.postUpdate(midTemp)
    Office_Heating_PresetTempNormal.postUpdate(lowTemp)
    Hall_Heating_PresetTempNormal.postUpdate(lowTemp)
    Heating_UpdateHeaters.sendCommand(ON)
end


// rule "22:30pm weekend"
// when
//     Time cron "0 20 23 ? * SAT-SUN *"
// then
//     CT_Heating_PresetTempNormal.postUpdate(liveTemp)
//     FR_Heating_PresetTempNormal.postUpdate(lowTemp)
//     E_BR_Heating_PresetTempNormal.postUpdate(midTemp)
//     Attic_Heating_PresetTempNormal.postUpdate(offTemp)
//     J_BR_Heating_PresetTempNormal.postUpdate(midTemp)
//     Office_Heating_PresetTempNormal.postUpdate(midTemp)
//     Hall_Heating_PresetTempNormal.postUpdate(midTemp)
//     Heating_UpdateHeaters.sendCommand(ON)
// end


rule "test"
when
    Time cron "00 8 11 ? * * *"
then
    // CT_Heating_PresetTempNormal.postUpdate(17.0)
    // FR_Heating_PresetTempNormal.postUpdate(21.0)
    // E_BR_Heating_PresetTempNormal.postUpdate(22.0)
    // Attic_Heating_PresetTempNormal.postUpdate(23.0)
    // J_BR_Heating_PresetTempNormal.postUpdate(24.0)
    //Office_Heating_PresetTempNormal.postUpdate(16.0)
    //Hall_Heating_PresetTempNormal.postUpdate(16.0)
    Heating_UpdateHeaters.sendCommand(ON)
end

