upgrade containers

backup any containers reqd
turn off in portainer and copy volume and docker script to backuip folder

for zigbee2mqtt
First determine the port of your adapter:
https://www.zigbee2mqtt.io/guide/configuration/adapter-settings.html#basic-configuration

pi@raspberry:/ $ ls -l /dev/serial/by-id
total 0
lrwxrwxrwx. 1 root root 13 Oct 19 19:26 usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF-if00 -> ../../ttyACM0

-- mine
pi@iotstack:~ $ ls -l /dev/serial/by-id
total 0
lrwxrwxrwx 1 root root 13 Aug  9 08:05 usb-1a86_USB_Serial-if00-port0 -> ../../ttyUSB0
pi@iotstack:~ $ 

my adapter is zstack based
https://www.zigbee2mqtt.io/guide/adapters/zstack.html
https://support.electrolama.com/radio-docs/#step-3-flash-the-firmware-on-your-stick

current
  zigbee2mqtt:
    container_name: zigbee2mqtt
    image: koenkk/zigbee2mqtt
    volumes:
      - ./volumes/zigbee2mqtt/data:/app/data
    devices:
      - /dev/ttyUSB0:/dev/ttyACM0
    ports:
      - 8080:8080
    environment:
      - TZ=Europe/London
    restart: unless-stopped

update to
  zigbee2mqtt:
    container_name: zigbee2mqtt
    image: ghcr.io/koenkk/zigbee2mqtt
    volumes:
      - ./volumes/zigbee2mqtt/data:/app/data
      - /run/udev:/run/udev:ro
    devices:
      - /dev/ttyUSB0:/dev/ttyACM0
    ports:
      - 8080:8080
    environment:
      - TZ=Europe/London
    restart: unless-stopped


    Starting the container

To start the Docker container:

docker compose up -d zigbee2mqtt

You can optionally skip zigbee2mqtt and it will start all containers listed in the compose file.
Updating

To update to the latest Docker image:

docker compose pull zigbee2mqtt
docker compose up -d zigbee2mqtt

You can optionally skip zigbee2mqtt and it will pull any new images for all containers in the compose file, and then restart those that were updated.

Basic configuration

In case Zigbee2MQTT cannot automatically detect your adapter (fails to start with: USB adapter discovery error (No valid USB adapter found). Specify valid 'adapter' and 'port' in your configuration.) we need to configure the serial section in the configuration.yaml.

First determine the port of your adapter:

    For USB adapters: when running on Windows see these instructions, for Linux execute ls -l /dev/serial/by-id:

pi@raspberry:/ $ ls -l /dev/serial/by-id
total 0
lrwxrwxrwx. 1 root root 13 Oct 19 19:26 usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF-if00 -> ../../ttyACM0

    For network adapters you need to find the IP address of your adapter through router/switch web-interface. Make sure that the adapter has been assigned a static IP address!
        Alternatively, in case your adapter supports mDNS, see the mDNS docs below.

Next determine what adapter you are using by going to your adapter page. Possible adapters are zstack, ember, deconz, zigate or zboss.

Given the example of the USB adapter above in combination with a zstack adapter, we would add the following to the configuration.yaml:

serial:
    # Location of the adapter
    # USB adapters - use format "port: /dev/serial/by-id/XXX"
    # Ethernet adapters - use format "port: tcp://192.168.1.12:6638"
    port: /dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF-if00
    # Adapter type, allowed values: `zstack`, `ember`, `deconz`, `zigate` or `zboss`
    adapter: zstack

This serial configuration should be enough to make Zigbee2MQTT start.
